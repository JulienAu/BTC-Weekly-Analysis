<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bitcoin ‚Äì Analyse Multi-Sc√©narios 2026‚Äì2030</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<style>
  :root {
    --bg-primary: #0a0e17;
    --bg-card: #111827;
    --bg-card-hover: #1a2235;
    --border: #1e293b;
    --text-primary: #f1f5f9;
    --text-secondary: #94a3b8;
    --text-muted: #64748b;
    --accent-red: #ef4444;
    --accent-red-bg: rgba(239,68,68,0.12);
    --accent-yellow: #f59e0b;
    --accent-yellow-bg: rgba(245,158,11,0.12);
    --accent-green: #10b981;
    --accent-green-bg: rgba(16,185,129,0.12);
    --accent-blue: #3b82f6;
    --accent-blue-bg: rgba(59,130,246,0.12);
    --accent-orange: #f97316;
    --gradient-red: linear-gradient(135deg, #dc2626, #991b1b);
    --gradient-yellow: linear-gradient(135deg, #d97706, #92400e);
    --gradient-green: linear-gradient(135deg, #059669, #065f46);
  }

  * { margin:0; padding:0; box-sizing:border-box; }

  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
    background: var(--bg-primary);
    color: var(--text-primary);
    line-height: 1.6;
    min-height: 100vh;
  }

  .container { max-width: 1400px; margin: 0 auto; padding: 24px; }

  /* ‚îÄ‚îÄ Header ‚îÄ‚îÄ */
  .header {
    text-align: center;
    padding: 48px 24px 32px;
    border-bottom: 1px solid var(--border);
    margin-bottom: 32px;
  }
  .header h1 {
    font-size: 2.2rem;
    font-weight: 700;
    letter-spacing: -0.5px;
    margin-bottom: 8px;
    background: linear-gradient(135deg, #f59e0b, #f97316);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }
  .header .subtitle {
    color: var(--text-secondary);
    font-size: 1rem;
  }
  .header .price-now {
    display: inline-flex;
    align-items: center;
    gap: 10px;
    margin-top: 16px;
    padding: 10px 24px;
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 12px;
    font-size: 0.95rem;
  }
  .header .price-now .live {
    font-weight: 700;
    font-size: 1.3rem;
    color: var(--accent-orange);
  }
  .header .price-now .change {
    color: var(--accent-red);
    font-size: 0.85rem;
    font-weight: 600;
  }

  /* ‚îÄ‚îÄ KPI row ‚îÄ‚îÄ */
  .kpi-row {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 16px;
    margin-bottom: 32px;
  }
  .kpi {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 20px;
    text-align: center;
  }
  .kpi .label { color: var(--text-muted); font-size: 0.78rem; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 6px; }
  .kpi .value { font-size: 1.5rem; font-weight: 700; }
  .kpi .sub { color: var(--text-secondary); font-size: 0.8rem; margin-top: 4px; }

  /* ‚îÄ‚îÄ Tabs ‚îÄ‚îÄ */
  .tab-bar {
    display: flex;
    gap: 4px;
    margin-bottom: 24px;
    background: var(--bg-card);
    border-radius: 12px;
    padding: 4px;
    border: 1px solid var(--border);
    overflow-x: auto;
  }
  .tab-btn {
    flex: 1;
    padding: 12px 16px;
    border: none;
    background: transparent;
    color: var(--text-muted);
    font-size: 0.9rem;
    font-weight: 600;
    border-radius: 10px;
    cursor: pointer;
    transition: all 0.2s;
    white-space: nowrap;
  }
  .tab-btn:hover { color: var(--text-primary); background: rgba(255,255,255,0.04); }
  .tab-btn.active { background: rgba(249,115,22,0.15); color: var(--accent-orange); }
  .tab-content { display: none; }
  .tab-content.active { display: block; }

  /* ‚îÄ‚îÄ Cards ‚îÄ‚îÄ */
  .card {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 28px;
    margin-bottom: 24px;
  }
  .card h2 {
    font-size: 1.15rem;
    font-weight: 700;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 10px;
  }
  .card h2 .dot {
    width: 10px; height: 10px; border-radius: 50%; display: inline-block;
  }

  /* ‚îÄ‚îÄ Scenario cards row ‚îÄ‚îÄ */
  .scenarios-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(340px, 1fr));
    gap: 20px;
    margin-bottom: 32px;
  }
  .scenario-card {
    background: var(--bg-card);
    border-radius: 16px;
    overflow: hidden;
    border: 1px solid var(--border);
    transition: transform 0.2s, border-color 0.2s;
  }
  .scenario-card:hover { transform: translateY(-2px); }
  .scenario-card.pessimiste { border-top: 3px solid var(--accent-red); }
  .scenario-card.neutre { border-top: 3px solid var(--accent-yellow); }
  .scenario-card.optimiste { border-top: 3px solid var(--accent-green); }

  .scenario-header {
    padding: 24px 24px 16px;
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
  }
  .scenario-header h3 { font-size: 1.1rem; font-weight: 700; }
  .scenario-header .badge {
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 700;
  }
  .badge.red { background: var(--accent-red-bg); color: var(--accent-red); }
  .badge.yellow { background: var(--accent-yellow-bg); color: var(--accent-yellow); }
  .badge.green { background: var(--accent-green-bg); color: var(--accent-green); }

  .scenario-body { padding: 0 24px 24px; }

  .metric-row {
    display: flex;
    justify-content: space-between;
    padding: 10px 0;
    border-bottom: 1px solid rgba(255,255,255,0.04);
    font-size: 0.88rem;
  }
  .metric-row:last-child { border-bottom: none; }
  .metric-row .mlabel { color: var(--text-secondary); }
  .metric-row .mvalue { font-weight: 600; text-align: right; }

  .prob-bar-container {
    margin-top: 16px;
    padding: 12px 16px;
    border-radius: 10px;
  }
  .prob-bar-container.red-bg { background: var(--accent-red-bg); }
  .prob-bar-container.yellow-bg { background: var(--accent-yellow-bg); }
  .prob-bar-container.green-bg { background: var(--accent-green-bg); }

  .prob-bar-label {
    display: flex;
    justify-content: space-between;
    font-size: 0.78rem;
    font-weight: 600;
    margin-bottom: 8px;
  }
  .prob-bar {
    height: 6px;
    background: rgba(255,255,255,0.1);
    border-radius: 3px;
    overflow: hidden;
  }
  .prob-bar .fill { height: 100%; border-radius: 3px; transition: width 1s ease; }
  .prob-bar .fill.red { background: var(--accent-red); }
  .prob-bar .fill.yellow { background: var(--accent-yellow); }
  .prob-bar .fill.green { background: var(--accent-green); }

  /* ‚îÄ‚îÄ Chart wrappers ‚îÄ‚îÄ */
  .chart-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-bottom: 24px;
  }
  .chart-wrapper {
    position: relative;
    width: 100%;
  }
  .chart-wrapper canvas { width: 100% !important; }

  @media (max-width: 900px) {
    .chart-grid { grid-template-columns: 1fr; }
    .scenarios-grid { grid-template-columns: 1fr; }
  }

  /* ‚îÄ‚îÄ Timeline ‚îÄ‚îÄ */
  .timeline {
    position: relative;
    padding: 20px 0 20px 32px;
  }
  .timeline::before {
    content: '';
    position: absolute;
    left: 11px;
    top: 0;
    bottom: 0;
    width: 2px;
    background: var(--border);
  }
  .tl-item {
    position: relative;
    margin-bottom: 28px;
  }
  .tl-item::before {
    content: '';
    position: absolute;
    left: -27px;
    top: 6px;
    width: 12px;
    height: 12px;
    border-radius: 50%;
    border: 2px solid var(--accent-orange);
    background: var(--bg-primary);
  }
  .tl-item.active::before {
    background: var(--accent-orange);
    box-shadow: 0 0 8px rgba(249,115,22,0.5);
  }
  .tl-date {
    font-size: 0.78rem;
    color: var(--accent-orange);
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 4px;
  }
  .tl-title { font-weight: 600; font-size: 0.95rem; margin-bottom: 4px; }
  .tl-desc { color: var(--text-secondary); font-size: 0.85rem; }

  /* ‚îÄ‚îÄ Comparison table ‚îÄ‚îÄ */
  .comp-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.88rem;
  }
  .comp-table thead th {
    padding: 12px 16px;
    text-align: left;
    font-weight: 700;
    color: var(--text-muted);
    text-transform: uppercase;
    font-size: 0.75rem;
    letter-spacing: 0.5px;
    border-bottom: 2px solid var(--border);
  }
  .comp-table tbody td {
    padding: 14px 16px;
    border-bottom: 1px solid rgba(255,255,255,0.04);
  }
  .comp-table tbody tr:hover { background: rgba(255,255,255,0.02); }
  .col-pess { color: var(--accent-red); font-weight: 600; }
  .col-neut { color: var(--accent-yellow); font-weight: 600; }
  .col-opti { color: var(--accent-green); font-weight: 600; }

  /* ‚îÄ‚îÄ Risk pills ‚îÄ‚îÄ */
  .risk-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
  }
  @media (max-width: 768px) { .risk-grid { grid-template-columns: 1fr; } }
  .risk-list { list-style: none; padding: 0; }
  .risk-list li {
    padding: 12px 16px;
    background: rgba(255,255,255,0.02);
    border-radius: 10px;
    margin-bottom: 8px;
    font-size: 0.88rem;
    border-left: 3px solid;
    line-height: 1.5;
  }
  .risk-list.downside li { border-left-color: var(--accent-red); }
  .risk-list.upside li { border-left-color: var(--accent-green); }
  .risk-list li strong { display: block; margin-bottom: 2px; }

  /* ‚îÄ‚îÄ Footer ‚îÄ‚îÄ */
  .footer {
    text-align: center;
    padding: 32px 24px;
    color: var(--text-muted);
    font-size: 0.78rem;
    border-top: 1px solid var(--border);
    margin-top: 32px;
  }

  /* ‚îÄ‚îÄ Horizontal legend ‚îÄ‚îÄ */
  .legend-row {
    display: flex;
    justify-content: center;
    gap: 24px;
    margin-bottom: 16px;
    flex-wrap: wrap;
  }
  .legend-item {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 0.82rem;
    color: var(--text-secondary);
  }
  .legend-dot { width: 10px; height: 10px; border-radius: 50%; }

  /* ‚îÄ‚îÄ Consensus block ‚îÄ‚îÄ */
  .consensus-block {
    background: linear-gradient(135deg, rgba(249,115,22,0.08), rgba(59,130,246,0.08));
    border: 1px solid rgba(249,115,22,0.2);
    border-radius: 14px;
    padding: 28px;
    margin-bottom: 24px;
    text-align: center;
  }
  .consensus-block h3 {
    font-size: 1rem;
    color: var(--accent-orange);
    margin-bottom: 12px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  .consensus-range {
    font-size: 2rem;
    font-weight: 800;
    margin: 8px 0;
  }
  .consensus-range .low { color: var(--accent-yellow); }
  .consensus-range .high { color: var(--accent-green); }
  .consensus-range .sep { color: var(--text-muted); margin: 0 6px; }
  .consensus-sub { color: var(--text-secondary); font-size: 0.88rem; margin-top: 8px; }

  /* ‚îÄ‚îÄ AI analysis lab ‚îÄ‚îÄ */
  .analysis-lab {
    background: linear-gradient(135deg, rgba(59,130,246,0.10), rgba(249,115,22,0.08));
    border: 1px solid rgba(59,130,246,0.35);
  }
  .analysis-controls {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 12px;
    margin-top: 16px;
    margin-bottom: 14px;
  }
  .analysis-controls input, .analysis-controls textarea, .analysis-controls select {
    width: 100%;
    background: rgba(255,255,255,0.03);
    border: 1px solid var(--border);
    color: var(--text-primary);
    border-radius: 10px;
    padding: 10px 12px;
    font-size: 0.86rem;
  }
  .analysis-controls textarea {
    min-height: 80px;
    resize: vertical;
    grid-column: 1 / -1;
  }
  .workflow-help {
    grid-column: 1 / -1;
    font-size: 0.8rem;
    color: var(--text-secondary);
    background: rgba(59,130,246,0.08);
    border: 1px solid rgba(59,130,246,0.25);
    padding: 10px 12px;
    border-radius: 10px;
  }
  .workflow-help code { color: var(--accent-blue); }
  .analysis-actions {
    display: flex;
    gap: 10px;
    align-items: center;
    flex-wrap: wrap;
  }
  .btn {
    border: none;
    border-radius: 10px;
    padding: 10px 14px;
    font-size: 0.85rem;
    font-weight: 700;
    cursor: pointer;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
  }
  .btn-primary { background: var(--accent-orange); color: #111827; }
  .btn-secondary { background: rgba(100,116,139,0.2); color: var(--text-primary); border: 1px solid var(--border); }
  .btn-disabled { opacity: 0.45; cursor: not-allowed; }
  .ai-status { color: var(--text-secondary); font-size: 0.82rem; }
  .version-box { margin-top: 14px; }
  .version-toolbar {
    display: flex;
    gap: 10px;
    align-items: center;
    flex-wrap: wrap;
    margin-bottom: 10px;
  }
  .version-toolbar select {
    min-width: 240px;
    background: rgba(255,255,255,0.03);
    border: 1px solid var(--border);
    color: var(--text-primary);
    border-radius: 10px;
    padding: 8px 10px;
    font-size: 0.84rem;
  }
  .version-meta { color: var(--text-muted); font-size: 0.8rem; margin-bottom: 8px; }
  .version-headline {
    color: var(--text-primary);
    font-size: 0.95rem;
    font-weight: 700;
    margin-bottom: 8px;
  }
  .analysis-output {
    white-space: pre-wrap;
    color: var(--text-secondary);
    font-size: 0.87rem;
    background: rgba(0,0,0,0.16);
    border: 1px solid rgba(255,255,255,0.04);
    border-radius: 10px;
    padding: 12px;
    margin-bottom: 12px;
    line-height: 1.55;
  }
  .diff-list { list-style: none; margin: 0; padding: 0; }
  .diff-list li {
    padding: 9px 12px;
    background: rgba(16,185,129,0.08);
    border-left: 3px solid var(--accent-green);
    border-radius: 8px;
    margin-bottom: 7px;
    font-size: 0.84rem;
    color: var(--text-secondary);
  }

</style>
</head>
<body>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê HEADER ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="header">
  <h1>‚Çø Bitcoin ‚Äî Analyse Multi-Sc√©narios</h1>
  <p class="subtitle">Synth√®se macro√©conomique et quantitative ¬∑ F√©vrier 2026</p>
  <div class="price-now">
    <span>BTC/USD</span>
    <span class="live">66 166 $</span>
    <span class="change">‚ñº ‚Äì47,6 % depuis ATH</span>
  </div>
</div>

<div class="container">

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê KPI ROW ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="kpi-row">
  <div class="kpi">
    <div class="label">ATH du cycle</div>
    <div class="value" style="color:var(--accent-orange)">126 000 $</div>
    <div class="sub">Octobre 2025</div>
  </div>
  <div class="kpi">
    <div class="label">Drawdown actuel</div>
    <div class="value" style="color:var(--accent-red)">‚Äì52 %</div>
    <div class="sub">Depuis ATH oct. 2025</div>
  </div>
  <div class="kpi">
    <div class="label">Fear & Greed</div>
    <div class="value" style="color:var(--accent-red)">14</div>
    <div class="sub">Peur extr√™me</div>
  </div>
  <div class="kpi">
    <div class="label">Co√ªt de production</div>
    <div class="value" style="color:var(--accent-yellow)">87 000 $</div>
    <div class="sub">Estim√© par JPMorgan</div>
  </div>
  <div class="kpi">
    <div class="label">ETF sorties semaine</div>
    <div class="value" style="color:var(--accent-red)">‚Äì1,7 Md $</div>
    <div class="sub">Janvier 2026</div>
  </div>
  <div class="kpi">
    <div class="label">Prochain halving</div>
    <div class="value" style="color:var(--accent-blue)">~2028</div>
    <div class="sub">Bloc 1 050 000</div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TABS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="tab-bar">
  <button class="tab-btn active" data-tab="overview">Vue d'ensemble</button>
  <button class="tab-btn" data-tab="scenarios">Sc√©narios d√©taill√©s</button>
  <button class="tab-btn" data-tab="timeline">Chronologie</button>
  <button class="tab-btn" data-tab="compare">Comparaison chiffr√©e</button>
  <button class="tab-btn" data-tab="risks">Risques & Consensus</button>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TAB 1 ‚Äî OVERVIEW ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="tab-content active" id="tab-overview">


  <div class="card analysis-lab">
    <h2><span class="dot" style="background:var(--accent-blue)"></span>Analyse IA continue (versionn√©e)</h2>
    <p style="color:var(--text-secondary); font-size:0.88rem;">D√©clenche une nouvelle analyse BTC via GitHub Actions (secret OpenAI c√¥t√© serveur), puis charge l'historique versionn√© publi√© dans ce dashboard pour comparer automatiquement les √©volutions majeures avec la version pr√©c√©dente.</p>

    <div class="analysis-controls">
      <input type="text" id="analysisTag" placeholder="Tag attendu (ex: Semaine 07-2026)">
      <input type="password" id="launchPassword" placeholder="Mot de passe fondateur pour lancer une nouvelle analyse">
      <textarea id="analysisContext" placeholder="Contexte √† transmettre dans GitHub Action (flows ETF, macro, r√©gulation, on-chain, sentiment...)."></textarea>
      <div class="workflow-help">La cl√© OpenAI reste c√¥t√© GitHub Actions via le secret <code>OPENAI_API_KEY</code>. Aucune cl√© n'est stock√©e dans le navigateur. Lancement prot√©g√© par mot de passe fondateur. 1) D√©verrouille, 2) lance le workflow, 3) attends le commit auto, 4) recharge ici.</div>
    </div>

    <div class="analysis-actions">
      <button class="btn btn-primary" id="runAnalysisBtn">üîÑ Charger la derni√®re analyse versionn√©e</button>
      <a class="btn btn-secondary" id="requestUpdateBtn" href="#" target="_blank" rel="noopener noreferrer">üöÄ Lancer une nouvelle analyse (GitHub Action ¬∑ prot√©g√©)</a>
      <button class="btn btn-secondary" id="exportVersionsBtn">‚¨áÔ∏è Exporter l'historique JSON</button>
      <span class="ai-status" id="aiStatus">Aucune analyse versionn√©e charg√©e pour le moment.</span>
    </div>

    <div class="version-box">
      <div class="version-toolbar">
        <label for="versionSelect" style="font-size:0.8rem; color:var(--text-muted);">Version √† afficher :</label>
        <select id="versionSelect">
          <option value="latest">Derni√®re version</option>
        </select>
      </div>
      <div class="version-meta" id="versionMeta">Version affich√©e : analyse initiale statique</div>
      <div class="version-headline" id="versionHeadline">Titre : n/a</div>
      <div class="analysis-output" id="analysisOutput">L'analyse IA appara√Ætra ici apr√®s publication GitHub Action.</div>
      <h3 style="font-size:0.9rem; margin-bottom:8px; color:var(--text-primary);">Grandes diff√©rences vs version pr√©c√©dente</h3>
      <ul class="diff-list" id="diffList"><li>Aucune comparaison disponible pour l'instant.</li></ul>
    </div>
  </div>

  <div class="legend-row">
    <div class="legend-item"><div class="legend-dot" style="background:var(--accent-red)"></div> Pessimiste (15‚Äì20 %)</div>
    <div class="legend-item"><div class="legend-dot" style="background:var(--accent-yellow)"></div> Neutre (40‚Äì50 %)</div>
    <div class="legend-item"><div class="legend-dot" style="background:var(--accent-green)"></div> Optimiste (25‚Äì30 %)</div>
  </div>

  <div class="chart-grid">
    <div class="card">
      <h2>Trajectoire de prix 2026‚Äì2030</h2>
      <div class="chart-wrapper"><canvas id="chartTrajectory"></canvas></div>
    </div>
    <div class="card">
      <h2>Fourchettes par horizon</h2>
      <div class="chart-wrapper"><canvas id="chartRanges"></canvas></div>
    </div>
  </div>

  <div class="chart-grid">
    <div class="card">
      <h2>Drawdowns historiques vs actuel</h2>
      <div class="chart-wrapper"><canvas id="chartDrawdowns"></canvas></div>
    </div>
    <div class="card">
      <h2>Probabilit√© par sc√©nario</h2>
      <div class="chart-wrapper"><canvas id="chartProba"></canvas></div>
    </div>
  </div>

  <!-- scenario cards -->
  <div class="scenarios-grid">
    <div class="scenario-card pessimiste">
      <div class="scenario-header">
        <h3>üî¥ Pessimiste</h3>
        <span class="badge red">15‚Äì20 %</span>
      </div>
      <div class="scenario-body">
        <div class="metric-row"><span class="mlabel">Top bull market</span><span class="mvalue col-pess">126 000 $ (atteint)</span></div>
        <div class="metric-row"><span class="mlabel">Bottom bear market</span><span class="mvalue col-pess">25 000 ‚Äì 40 000 $</span></div>
        <div class="metric-row"><span class="mlabel">Drawdown max</span><span class="mvalue col-pess">‚Äì68 √† ‚Äì80 %</span></div>
        <div class="metric-row"><span class="mlabel">Bottom attendu</span><span class="mvalue">√ât√©‚ÄìAutomne 2026</span></div>
        <div class="metric-row"><span class="mlabel">Recovery</span><span class="mvalue">2028+</span></div>
        <div class="prob-bar-container red-bg">
          <div class="prob-bar-label"><span>Probabilit√©</span><span style="color:var(--accent-red)">17,5 %</span></div>
          <div class="prob-bar"><div class="fill red" style="width:17.5%"></div></div>
        </div>
      </div>
    </div>

    <div class="scenario-card neutre">
      <div class="scenario-header">
        <h3>üü° Neutre</h3>
        <span class="badge yellow">40‚Äì50 %</span>
      </div>
      <div class="scenario-body">
        <div class="metric-row"><span class="mlabel">Top bull market</span><span class="mvalue col-neut">150 000 ‚Äì 250 000 $</span></div>
        <div class="metric-row"><span class="mlabel">Bottom bear market</span><span class="mvalue col-neut">45 000 ‚Äì 65 000 $</span></div>
        <div class="metric-row"><span class="mlabel">Drawdown max</span><span class="mvalue col-neut">‚Äì48 √† ‚Äì64 %</span></div>
        <div class="metric-row"><span class="mlabel">Bottom attendu</span><span class="mvalue">T1‚ÄìT2 2026</span></div>
        <div class="metric-row"><span class="mlabel">Nouveau top</span><span class="mvalue">2029</span></div>
        <div class="prob-bar-container yellow-bg">
          <div class="prob-bar-label"><span>Probabilit√©</span><span style="color:var(--accent-yellow)">45 %</span></div>
          <div class="prob-bar"><div class="fill yellow" style="width:45%"></div></div>
        </div>
      </div>
    </div>

    <div class="scenario-card optimiste">
      <div class="scenario-header">
        <h3>üü¢ Optimiste</h3>
        <span class="badge green">25‚Äì30 %</span>
      </div>
      <div class="scenario-body">
        <div class="metric-row"><span class="mlabel">Top bull market</span><span class="mvalue col-opti">175 000 ‚Äì 250 000 $</span></div>
        <div class="metric-row"><span class="mlabel">Bottom bear market</span><span class="mvalue col-opti">55 000 ‚Äì 70 000 $</span></div>
        <div class="metric-row"><span class="mlabel">Drawdown max</span><span class="mvalue col-opti">‚Äì44 √† ‚Äì56 %</span></div>
        <div class="metric-row"><span class="mlabel">Bottom attendu</span><span class="mvalue">F√©v‚ÄìAvr 2026</span></div>
        <div class="metric-row"><span class="mlabel">Nouveau top</span><span class="mvalue">Fin 2026‚ÄìMi-2027</span></div>
        <div class="prob-bar-container green-bg">
          <div class="prob-bar-label"><span>Probabilit√©</span><span style="color:var(--accent-green)">27,5 %</span></div>
          <div class="prob-bar"><div class="fill green" style="width:27.5%"></div></div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TAB 2 ‚Äî SCENARIOS D√âTAILL√âS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="tab-content" id="tab-scenarios">

  <div class="card" style="border-left: 3px solid var(--accent-red);">
    <h2><span class="dot" style="background:var(--accent-red)"></span> Sc√©nario Pessimiste</h2>
    <p style="color:var(--text-secondary); margin-bottom:16px;"><strong style="color:var(--text-primary)">Contexte macro :</strong> R√©cession mondiale ou stagflation prolong√©e. La Fed durcit sa politique mon√©taire face √† une inflation persistante. Crise de liquidit√© syst√©mique amplifi√©e par un √©v√©nement de cr√©dit. BTC trait√© comme un actif risqu√© pur.</p>
    <p style="color:var(--text-secondary); margin-bottom:16px;"><strong style="color:var(--text-primary)">Narratif march√© :</strong> Le cycle de 4 ans reste pleinement intact. Le top de 126 000 $ est confirm√©. La correction s'approfondit, amplifi√©e par des sorties massives des ETF et une capitulation retail. Potentiel √©v√©nement syst√©mique crypto (faille quantique, hack majeur). Analystes align√©s : Peter Brandt, Fidelity (Timmer), Rekt Capital.</p>
    <div style="display:grid; grid-template-columns:1fr 1fr; gap:16px; margin-top:16px;">
      <div style="background:var(--accent-red-bg); padding:16px; border-radius:10px;">
        <div style="color:var(--text-muted); font-size:0.78rem; margin-bottom:4px;">TOP BULL MARKET</div>
        <div style="font-size:1.3rem; font-weight:700; color:var(--accent-red);">126 000 $</div>
        <div style="font-size:0.8rem; color:var(--text-secondary);">D√©j√† atteint ‚Äì Oct 2025</div>
      </div>
      <div style="background:var(--accent-red-bg); padding:16px; border-radius:10px;">
        <div style="color:var(--text-muted); font-size:0.78rem; margin-bottom:4px;">BOTTOM BEAR MARKET</div>
        <div style="font-size:1.3rem; font-weight:700; color:var(--accent-red);">25 000 ‚Äì 40 000 $</div>
        <div style="font-size:0.8rem; color:var(--text-secondary);">√ât√©‚ÄìAutomne 2026</div>
      </div>
    </div>
    <p style="color:var(--text-secondary); margin-top:16px; font-size:0.88rem;"><strong style="color:var(--text-primary)">Conditions requises :</strong> R√©cession profonde + √©v√©nement black swan crypto + sorties ETF prolong√©es. JPMorgan note que la pr√©sence des ETF rend un drawdown de 80 % peu probable, mais pas impossible en crise syst√©mique.</p>
  </div>

  <div class="card" style="border-left: 3px solid var(--accent-yellow);">
    <h2><span class="dot" style="background:var(--accent-yellow)"></span> Sc√©nario Neutre (Base Case)</h2>
    <p style="color:var(--text-secondary); margin-bottom:16px;"><strong style="color:var(--text-primary)">Contexte macro :</strong> Ralentissement mod√©r√© sans r√©cession majeure. Fed reprend les baisses de taux au S2 2026 (1‚Äì2 baisses). Liquidit√© globale en expansion mod√©r√©e. Adoption institutionnelle continue mais sans acc√©l√©ration spectaculaire.</p>
    <p style="color:var(--text-secondary); margin-bottom:16px;"><strong style="color:var(--text-primary)">Narratif march√© :</strong> Cycle de 4 ans modifi√© mais pas aboli. Le drawdown de 52 % est le gros de la correction, mais le bottom n'est pas encore atteint. Plancher entre 45 000 et 65 000 $ au S1 2026, puis consolidation. ETF comme amortisseur structurel. Analystes align√©s : Standard Chartered (150 k$), Bernstein (150 k$), Fidelity (Timmer, 65‚Äì75 k$ plancher).</p>
    <div style="display:grid; grid-template-columns:1fr 1fr; gap:16px; margin-top:16px;">
      <div style="background:var(--accent-yellow-bg); padding:16px; border-radius:10px;">
        <div style="color:var(--text-muted); font-size:0.78rem; margin-bottom:4px;">TOP PROCHAIN CYCLE</div>
        <div style="font-size:1.3rem; font-weight:700; color:var(--accent-yellow);">150 000 ‚Äì 250 000 $</div>
        <div style="font-size:0.8rem; color:var(--text-secondary);">2028‚Äì2029 (post-halving)</div>
      </div>
      <div style="background:var(--accent-yellow-bg); padding:16px; border-radius:10px;">
        <div style="color:var(--text-muted); font-size:0.78rem; margin-bottom:4px;">BOTTOM CE CYCLE</div>
        <div style="font-size:1.3rem; font-weight:700; color:var(--accent-yellow);">45 000 ‚Äì 65 000 $</div>
        <div style="font-size:0.8rem; color:var(--text-secondary);">T1‚ÄìT2 2026</div>
      </div>
    </div>
    <p style="color:var(--text-secondary); margin-top:16px; font-size:0.88rem;"><strong style="color:var(--text-primary)">Conditions requises :</strong> Trajectoire macro actuelle prolong√©e. Pas de choc syst√©mique majeur. Les flux ETF se stabilisent puis reprennent. Le co√ªt de production (87 k$) agit comme aimant √† moyen terme.</p>
  </div>

  <div class="card" style="border-left: 3px solid var(--accent-green);">
    <h2><span class="dot" style="background:var(--accent-green)"></span> Sc√©nario Optimiste</h2>
    <p style="color:var(--text-secondary); margin-bottom:16px;"><strong style="color:var(--text-primary)">Contexte macro :</strong> Fed acc√©l√®re les baisses de taux (3‚Äì4 baisses en 2026). Liquidit√© en forte expansion. Adoption du CLARITY Act + guidance DOL 401(k). Plusieurs nations annoncent des r√©serves strat√©giques BTC. Pas de r√©cession.</p>
    <p style="color:var(--text-secondary); margin-bottom:16px;"><strong style="color:var(--text-primary)">Narratif march√© :</strong> Le cycle de 4 ans est perturb√© par les flux institutionnels. La correction actuelle n'est qu'un drawdown mid-cycle (comme les ‚Äì35 % de juillet-sept 2021). Les whales accumulent massivement. BTC rebondit fort au S2 2026. Analystes align√©s : Cathie Wood / ARK, Fundstrat (Tom Lee), JPMorgan (266 k$ long terme), Goldman Sachs (200 k$).</p>
    <div style="display:grid; grid-template-columns:1fr 1fr; gap:16px; margin-top:16px;">
      <div style="background:var(--accent-green-bg); padding:16px; border-radius:10px;">
        <div style="color:var(--text-muted); font-size:0.78rem; margin-bottom:4px;">TOP BULL MARKET</div>
        <div style="font-size:1.3rem; font-weight:700; color:var(--accent-green);">175 000 ‚Äì 250 000 $</div>
        <div style="font-size:0.8rem; color:var(--text-secondary);">Fin 2026 ‚Äì Mi-2027</div>
      </div>
      <div style="background:var(--accent-green-bg); padding:16px; border-radius:10px;">
        <div style="color:var(--text-muted); font-size:0.78rem; margin-bottom:4px;">BOTTOM CE CYCLE</div>
        <div style="font-size:1.3rem; font-weight:700; color:var(--accent-green);">55 000 ‚Äì 70 000 $</div>
        <div style="font-size:0.8rem; color:var(--text-secondary);">Bottom proche / en cours</div>
      </div>
    </div>
    <p style="color:var(--text-secondary); margin-top:16px; font-size:0.88rem;"><strong style="color:var(--text-primary)">Potentiel super-cycle 2029‚Äì2030 :</strong> Si r√©serves souveraines + 401(k) + MiCA + halving 2028 convergent ‚Üí 300 000‚Äì500 000 $+. ARK Invest cible 500 k$ (bear) √† 2,4 M$ (bull) d'ici 2030.</p>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TAB 3 ‚Äî TIMELINE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="tab-content" id="tab-timeline">

  <div class="card">
    <h2>Chronologie des √©v√©nements cl√©s & phases de march√©</h2>

    <div class="timeline">
      <div class="tl-item">
        <div class="tl-date">Avril 2024</div>
        <div class="tl-title">4√®me Halving Bitcoin</div>
        <div class="tl-desc">R√©compense passe de 6,25 √† 3,125 BTC/bloc. √âmission annuelle r√©duite √† 0,85 %.</div>
      </div>
      <div class="tl-item">
        <div class="tl-date">Octobre 2025</div>
        <div class="tl-title">ATH √† 126 000 $</div>
        <div class="tl-desc">Sommet du cycle √† 18 mois post-halving. Conforme aux patterns historiques (12‚Äì18 mois).</div>
      </div>
      <div class="tl-item">
        <div class="tl-date">Nov. 2025 ‚Äì Jan. 2026</div>
        <div class="tl-title">Phase de distribution & correction</div>
        <div class="tl-desc">Sorties ETF massives (‚Äì1,7 Md$/sem.), volumes en baisse de 30 %, participation retail en recul.</div>
      </div>
      <div class="tl-item active">
        <div class="tl-date">F√©vrier 2026 ‚Äî Nous sommes ici</div>
        <div class="tl-title">BTC √† ~66 000 $ ¬∑ Fear & Greed = 14</div>
        <div class="tl-desc">Drawdown de ‚Äì52 % depuis l'ATH. BTC sous le co√ªt de production (87 k$). Capitulation en cours.</div>
      </div>
      <div class="tl-item">
        <div class="tl-date">T1‚ÄìT2 2026</div>
        <div class="tl-title">Zone de bottom probable (neutre / optimiste)</div>
        <div class="tl-desc">Fourchette attendue : 45 000‚Äì65 000 $ (neutre) ou 55 000‚Äì70 000 $ (optimiste). Accumulation whale.</div>
      </div>
      <div class="tl-item">
        <div class="tl-date">√ât√© ‚Äì Automne 2026</div>
        <div class="tl-title">Catalyseurs r√©glementaires & mon√©taires</div>
        <div class="tl-desc">CLARITY Act au S√©nat. Guidance DOL 401(k). Potentielles baisses de taux Fed. Reprise des flux ETF.</div>
      </div>
      <div class="tl-item">
        <div class="tl-date">S2 2026 ‚Äì 2027</div>
        <div class="tl-title">Phase de recovery / extension haussi√®re</div>
        <div class="tl-desc">Neutre : retour vers 80‚Äì100 k$. Optimiste : extension vers 175‚Äì250 k$. Pessimiste : consolidation 30‚Äì50 k$.</div>
      </div>
      <div class="tl-item">
        <div class="tl-date">~2028</div>
        <div class="tl-title">5√®me Halving Bitcoin</div>
        <div class="tl-desc">R√©compense √† 1,5625 BTC/bloc. Catalyseur du prochain m√©ga-cycle si les fondamentaux soutiennent.</div>
      </div>
      <div class="tl-item">
        <div class="tl-date">2029‚Äì2030</div>
        <div class="tl-title">Prochain bull market potentiel</div>
        <div class="tl-desc">Neutre : 150‚Äì250 k$. Optimiste : 300‚Äì500 k$+. ARK Invest cible 500 k$ (bear) √† 2,4 M$ (bull).</div>
      </div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TAB 4 ‚Äî COMPARE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="tab-content" id="tab-compare">

  <div class="card">
    <h2>Comparaison chiffr√©e compl√®te</h2>
    <div style="overflow-x:auto;">
    <table class="comp-table">
      <thead>
        <tr>
          <th>M√©trique</th>
          <th>üî¥ Pessimiste</th>
          <th>üü° Neutre</th>
          <th>üü¢ Optimiste</th>
        </tr>
      </thead>
      <tbody>
        <tr><td>Probabilit√©</td><td class="col-pess">15‚Äì20 %</td><td class="col-neut">40‚Äì50 %</td><td class="col-opti">25‚Äì30 %</td></tr>
        <tr><td>Top cycle actuel</td><td class="col-pess">126 000 $ (atteint)</td><td class="col-neut">126 000 $ (atteint)</td><td class="col-opti">175 000 ‚Äì 250 000 $</td></tr>
        <tr><td>Bottom ce bear</td><td class="col-pess">25 000 ‚Äì 40 000 $</td><td class="col-neut">45 000 ‚Äì 65 000 $</td><td class="col-opti">55 000 ‚Äì 70 000 $</td></tr>
        <tr><td>Drawdown max</td><td class="col-pess">‚Äì68 √† ‚Äì80 %</td><td class="col-neut">‚Äì48 √† ‚Äì64 %</td><td class="col-opti">‚Äì44 √† ‚Äì56 %</td></tr>
        <tr><td>Timing du bottom</td><td class="col-pess">√ât√©‚ÄìAutomne 2026</td><td class="col-neut">T1‚ÄìT2 2026</td><td class="col-opti">F√©v‚ÄìAvr 2026</td></tr>
        <tr><td>Prix fin 2026</td><td class="col-pess">30 000 ‚Äì 50 000 $</td><td class="col-neut">70 000 ‚Äì 100 000 $</td><td class="col-opti">150 000 ‚Äì 200 000 $</td></tr>
        <tr><td>Top prochain cycle (2029)</td><td class="col-pess">90 000 ‚Äì 120 000 $</td><td class="col-neut">150 000 ‚Äì 250 000 $</td><td class="col-opti">300 000 ‚Äì 500 000 $+</td></tr>
        <tr><td>Bottom prochain bear</td><td class="col-pess">50 000 ‚Äì 80 000 $</td><td class="col-neut">100 000 ‚Äì 150 000 $</td><td class="col-opti">200 000 ‚Äì 300 000 $</td></tr>
        <tr><td>Dur√©e du bear market</td><td class="col-pess">12‚Äì18 mois</td><td class="col-neut">8‚Äì12 mois</td><td class="col-opti">3‚Äì6 mois (mid-cycle)</td></tr>
        <tr><td>Facteur d√©clencheur</td><td class="col-pess">R√©cession / Black swan</td><td class="col-neut">Cycle standard modifi√©</td><td class="col-opti">Super-cycle institutionnel</td></tr>
      </tbody>
    </table>
    </div>
  </div>

  <div class="card">
    <h2>Fourchettes de prix par horizon</h2>
    <div class="chart-wrapper"><canvas id="chartHorizon"></canvas></div>
  </div>

  <div class="card">
    <h2>Cycles historiques ‚Äî Amplitude compar√©e</h2>
    <div class="chart-wrapper"><canvas id="chartCycles"></canvas></div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TAB 5 ‚Äî RISKS & CONSENSUS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="tab-content" id="tab-risks">

  <div class="consensus-block">
    <h3>Consensus institutionnel implicite ‚Äî Horizon 3‚Äì5 ans</h3>
    <div class="consensus-range">
      <span class="low">45 000 $</span>
      <span class="sep">‚Üí</span>
      <span class="high">250 000 ‚Äì 300 000 $</span>
    </div>
    <div class="consensus-sub">
      Fair value m√©dian estim√© 2028‚Äì2029 : <strong style="color:var(--accent-orange)">150 000 ‚Äì 200 000 $</strong><br>
      Sources : JPMorgan (170‚Äì266 k$), Standard Chartered (150 k$), Bernstein (150‚Äì200 k$), Goldman Sachs (~200 k$)
    </div>
  </div>

  <div class="card">
    <h2>Principaux risques de surprise</h2>
    <div class="risk-grid">
      <div>
        <h3 style="color:var(--accent-red); font-size:0.95rem; margin-bottom:12px;">‚ñº Risques Downside</h3>
        <ul class="risk-list downside">
          <li><strong>Choc de liquidit√© syst√©mique</strong>Crise bancaire ou dette souveraine for√ßant une liquidation massive d'actifs, y compris crypto.</li>
          <li><strong>Menace quantique</strong>2025 est la premi√®re ann√©e o√π le d√©lai avant qu'un ordinateur quantique puisse potentiellement casser la cryptographie BTC est inf√©rieur au temps estim√© pour une mise √† niveau du r√©seau (Charles Edwards, Capriole).</li>
          <li><strong>Retournement r√©glementaire</strong>√âchec du CLARITY Act au S√©nat, changement politique, ou durcissement r√©glementaire inattendu.</li>
          <li><strong>Yen carry trade unwind</strong>D√©bouclage massif des positions yen/dollar causant un risk-off brutal sur tous les march√©s.</li>
        </ul>
      </div>
      <div>
        <h3 style="color:var(--accent-green); font-size:0.95rem; margin-bottom:12px;">‚ñ≤ Risques Upside</h3>
        <ul class="risk-list upside">
          <li><strong>R√©serve strat√©gique US formalis√©e</strong>Choc de demande souveraine avec effet domino si d'autres nations suivent. 16 nations ont d√©j√† propos√© ou adopt√© des l√©gislations similaires.</li>
          <li><strong>Ouverture des 401(k)</strong>Guidance DOL permettant l'allocation crypto dans les plans retraite : 150‚Äì450 Md$ de demande potentielle.</li>
          <li><strong>Pivot Fed acc√©l√©r√©</strong>D√©t√©rioration √©conomique rapide for√ßant un assouplissement mon√©taire agressif, tr√®s bullish pour les actifs de r√©serve.</li>
          <li><strong>Super-cycle institutionnel</strong>Confluence ETF + adoption souveraine + rar√©faction de l'offre produisant un cycle d'ampleur in√©dite (th√®se Raoul Pal, Cathie Wood).</li>
        </ul>
      </div>
    </div>
  </div>

  <div class="card">
    <h2>Positionnement actuel du march√©</h2>
    <p style="color:var(--text-secondary); font-size:0.92rem; line-height:1.7;">
      Le march√© se situe en zone de peur extr√™me (Fear & Greed = 14), avec un cours significativement sous le co√ªt de production estim√© (87 k$ selon JPMorgan). Le clustering des pr√©visions institutionnelles autour de 150‚Äì200 k$ pour 2026‚Äì2027 contraste avec le positionnement d√©fensif de Goldman Sachs (puts > calls en ratio 4:1). Le march√© des options price des probabilit√©s quasi-√©gales de voir le BTC √† 50 000 $ ou √† 250 000 $ d'ici fin 2026 (Galaxy Digital), refl√©tant un "fat tail" bilat√©ral inhabituel. Les whales accumulent activement (score Glassnode √† 0,68, 4 Md$ d'achats/semaine d√©but f√©vrier), tandis que le retail continue de vendre ‚Äî un pattern historiquement observ√© aux bottoms de cycle.
    </p>
  </div>
</div>

</div><!-- /container -->

<div class="footer">
  Ce document constitue une synth√®se analytique √† vocation informative. Il ne constitue en aucun cas un conseil en investissement.<br>
  Sources : JPMorgan, Goldman Sachs, Standard Chartered, Bernstein, Fidelity, ARK Invest, Galaxy Digital, Fundstrat, Glassnode, Messari, Grayscale, Bloomberg Intelligence, CryptoQuant.<br>
  G√©n√©r√© le 12 f√©vrier 2026.
</div>

<script>
// ‚îÄ‚îÄ Colors ‚îÄ‚îÄ
const RED = '#ef4444';
const RED_BG = 'rgba(239,68,68,0.15)';
const YELLOW = '#f59e0b';
const YELLOW_BG = 'rgba(245,158,11,0.15)';
const GREEN = '#10b981';
const GREEN_BG = 'rgba(16,185,129,0.15)';
const ORANGE = '#f97316';
const BLUE = '#3b82f6';
const GRID = 'rgba(255,255,255,0.05)';
const TICK = '#64748b';

Chart.defaults.color = TICK;
Chart.defaults.borderColor = GRID;
Chart.defaults.font.family = "-apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif";

// ‚îÄ‚îÄ Tab logic ‚îÄ‚îÄ
document.querySelectorAll('.tab-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
    btn.classList.add('active');
    document.getElementById('tab-' + btn.dataset.tab).classList.add('active');
  });
});

// ‚îÄ‚îÄ Utility ‚îÄ‚îÄ
function fmt(n) { return n >= 1000 ? (n/1000).toFixed(0) + 'k$' : n + '$'; }

// ‚îÄ‚îÄ AI analysis workflow (GitHub-hosted versioning, no client API key) ‚îÄ‚îÄ
const HISTORY_URL = 'data/analysis-history.json';

const analysisTagInput = document.getElementById('analysisTag');
const analysisContextInput = document.getElementById('analysisContext');
const runAnalysisBtn = document.getElementById('runAnalysisBtn');
const requestUpdateBtn = document.getElementById('requestUpdateBtn');
const launchPasswordInput = document.getElementById('launchPassword');
const exportVersionsBtn = document.getElementById('exportVersionsBtn');
const aiStatus = document.getElementById('aiStatus');
const versionSelect = document.getElementById('versionSelect');
const versionMeta = document.getElementById('versionMeta');
const versionHeadline = document.getElementById('versionHeadline');
const analysisOutput = document.getElementById('analysisOutput');
const diffList = document.getElementById('diffList');

let cachedVersions = [];
const REQUIRED_LAUNCH_PASSWORD = 'founders123';
let launchUnlocked = sessionStorage.getItem('btcLaunchUnlocked') === '1';

function renderVersion(version, prevVersion) {
  if (!version) {
    versionMeta.textContent = "Version affich√©e : analyse initiale statique";
    versionHeadline.textContent = "Titre : n/a";
    analysisOutput.textContent = "L'analyse IA appara√Ætra ici apr√®s publication par GitHub Action.";
    diffList.innerHTML = '<li>Aucune comparaison disponible pour l'instant.</li>';
    return;
  }

  versionMeta.textContent = `Version ${version.version} ¬∑ ${version.tag || 'sans tag'} ¬∑ ${new Date(version.createdAt).toLocaleString('fr-FR')}`;
  versionHeadline.textContent = `Titre : ${version.headline || 'Mise √† jour BTC'}`;
  analysisOutput.textContent = version.analysis;

  const diffs = version.differences?.length
    ? version.differences
    : (prevVersion ? ['Diff√©rences non structur√©es dans cette version.'] : ['Premi√®re version IA enregistr√©e.']);
  diffList.innerHTML = diffs.map(item => `<li>${item}</li>`).join('');
}

function hydrateVersionSelect(versions) {
  versionSelect.innerHTML = '';
  if (!versions.length) {
    const empty = document.createElement('option');
    empty.value = '';
    empty.textContent = 'Aucune version disponible';
    versionSelect.appendChild(empty);
    versionSelect.disabled = true;
    return;
  }

  versionSelect.disabled = false;
  const latest = document.createElement('option');
  latest.value = 'latest';
  latest.textContent = `Derni√®re version (#${versions[versions.length - 1].version})`;
  versionSelect.appendChild(latest);

  versions.slice().reverse().forEach((version) => {
    const option = document.createElement('option');
    option.value = String(version.version);
    option.textContent = `#${version.version} ¬∑ ${version.tag || 'sans tag'} ¬∑ ${new Date(version.createdAt).toLocaleDateString('fr-FR')}`;
    versionSelect.appendChild(option);
  });
}

function renderSelectedVersion() {
  if (!cachedVersions.length) {
    renderVersion(null, null);
    return;
  }

  const selected = versionSelect.value;
  const target = selected === 'latest'
    ? cachedVersions[cachedVersions.length - 1]
    : cachedVersions.find((v) => String(v.version) === selected);

  if (!target) {
    renderVersion(cachedVersions[cachedVersions.length - 1], cachedVersions[cachedVersions.length - 2]);
    return;
  }

  const prev = cachedVersions.find((v) => v.version === target.version - 1);
  renderVersion(target, prev);
}

async function loadPublishedVersions() {
  aiStatus.textContent = 'Chargement des analyses versionn√©es...';
  try {
    const response = await fetch(`${HISTORY_URL}?t=${Date.now()}`);
    if (!response.ok) throw new Error(`Fichier introuvable (${response.status})`);

    const payload = await response.json();
    cachedVersions = Array.isArray(payload.versions) ? payload.versions : [];

    hydrateVersionSelect(cachedVersions);
    versionSelect.value = 'latest';
    renderSelectedVersion();

    aiStatus.textContent = cachedVersions.length
      ? `${cachedVersions.length} version(s) charg√©e(s) depuis GitHub. Derni√®re mise √† jour: ${new Date(payload.updatedAt || cachedVersions[cachedVersions.length - 1].createdAt).toLocaleString('fr-FR')}`
      : 'Historique vide: lance la GitHub Action pour g√©n√©rer la premi√®re analyse.';
  } catch (error) {
    aiStatus.textContent = `‚ö†Ô∏è Impossible de charger l'historique: ${error.message}`;
  }
}

function exportVersions() {
  const blob = new Blob([JSON.stringify(cachedVersions, null, 2)], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `btc-analysis-versions-${new Date().toISOString().slice(0,10)}.json`;
  document.body.appendChild(a);
  a.click();
  a.remove();
  URL.revokeObjectURL(url);
}

function inferRepoActionsUrl() {
  const host = window.location.hostname;
  if (host.endsWith('github.io')) {
    const repo = window.location.pathname.split('/').filter(Boolean)[0];
    const owner = host.replace('.github.io', '');
    if (repo && owner) return `https://github.com/${owner}/${repo}/actions/workflows/update-btc-analysis.yml`;
  }
  return 'https://github.com/OWNER/REPO/actions/workflows/update-btc-analysis.yml';
}

function updateWorkflowLink() {
  const tag = encodeURIComponent(analysisTagInput.value.trim() || 'Manual run');
  const context = encodeURIComponent(analysisContextInput.value.trim() || 'Aucun contexte');
  const base = inferRepoActionsUrl();
  requestUpdateBtn.href = `${base}?query=event%3Aworkflow_dispatch&tag=${tag}&context=${context}`;
}


function syncLaunchLockUi() {
  if (launchUnlocked) {
    requestUpdateBtn.classList.remove('btn-disabled');
    requestUpdateBtn.removeAttribute('aria-disabled');
    if (!aiStatus.textContent.includes('charg√©e')) {
      aiStatus.textContent = '‚úÖ D√©verrouill√© : lancement workflow autoris√© pour cette session.';
    }
  } else {
    requestUpdateBtn.classList.add('btn-disabled');
    requestUpdateBtn.setAttribute('aria-disabled', 'true');
  }
}

function tryUnlockLaunch() {
  const candidate = launchPasswordInput.value;
  if (candidate === REQUIRED_LAUNCH_PASSWORD) {
    launchUnlocked = true;
    sessionStorage.setItem('btcLaunchUnlocked', '1');
    launchPasswordInput.value = '';
    syncLaunchLockUi();
    return true;
  }
  aiStatus.textContent = '‚õî Mot de passe invalide pour lancer une nouvelle analyse.';
  return false;
}

requestUpdateBtn.addEventListener('click', (event) => {
  if (!launchUnlocked && !tryUnlockLaunch()) {
    event.preventDefault();
    return;
  }
});

launchPasswordInput.addEventListener('keydown', (event) => {
  if (event.key === 'Enter') {
    event.preventDefault();
    tryUnlockLaunch();
  }
});

runAnalysisBtn.addEventListener('click', loadPublishedVersions);
exportVersionsBtn.addEventListener('click', exportVersions);
versionSelect.addEventListener('change', renderSelectedVersion);
analysisTagInput.addEventListener('input', updateWorkflowLink);
analysisContextInput.addEventListener('input', updateWorkflowLink);

updateWorkflowLink();
syncLaunchLockUi();
loadPublishedVersions();

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CHART 1 ‚Äî Trajectory (line chart)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const labels1 = ['Oct 2025\n(ATH)', 'F√©v 2026\n(Actuel)', '√ât√© 2026', 'Fin 2026', 'Mi-2027', 'Fin 2027', '2028\n(Halving)', 'Mi-2029', 'Fin 2029', '2030'];
new Chart(document.getElementById('chartTrajectory'), {
  type: 'line',
  data: {
    labels: labels1,
    datasets: [
      {
        label: 'Pessimiste',
        data: [126000, 66000, 35000, 40000, 55000, 65000, 75000, 90000, 110000, 100000],
        borderColor: RED, backgroundColor: RED_BG,
        fill: false, tension: 0.35, borderWidth: 2.5, pointRadius: 3
      },
      {
        label: 'Neutre',
        data: [126000, 66000, 50000, 85000, 100000, 110000, 120000, 180000, 230000, 200000],
        borderColor: YELLOW, backgroundColor: YELLOW_BG,
        fill: false, tension: 0.35, borderWidth: 2.5, pointRadius: 3
      },
      {
        label: 'Optimiste',
        data: [126000, 66000, 95000, 175000, 220000, 190000, 200000, 350000, 450000, 400000],
        borderColor: GREEN, backgroundColor: GREEN_BG,
        fill: false, tension: 0.35, borderWidth: 2.5, pointRadius: 3
      }
    ]
  },
  options: {
    responsive: true,
    interaction: { mode: 'index', intersect: false },
    plugins: {
      legend: { display: true, position: 'bottom', labels: { usePointStyle: true, padding: 20 } },
      tooltip: {
        callbacks: {
          label: ctx => ctx.dataset.label + ': ' + ctx.parsed.y.toLocaleString() + ' $'
        }
      }
    },
    scales: {
      y: {
        ticks: { callback: v => fmt(v) },
        grid: { color: GRID }
      },
      x: { grid: { display: false } }
    }
  }
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CHART 2 ‚Äî Ranges (floating bar)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
new Chart(document.getElementById('chartRanges'), {
  type: 'bar',
  data: {
    labels: ['Bottom 2026', 'Prix fin 2026', 'Top prochain cycle', 'Bottom suivant'],
    datasets: [
      {
        label: 'Pessimiste',
        data: [[25000,40000],[30000,50000],[90000,120000],[50000,80000]],
        backgroundColor: 'rgba(239,68,68,0.7)', borderColor: RED, borderWidth: 1, borderRadius: 4
      },
      {
        label: 'Neutre',
        data: [[45000,65000],[70000,100000],[150000,250000],[100000,150000]],
        backgroundColor: 'rgba(245,158,11,0.7)', borderColor: YELLOW, borderWidth: 1, borderRadius: 4
      },
      {
        label: 'Optimiste',
        data: [[55000,70000],[150000,200000],[300000,500000],[200000,300000]],
        backgroundColor: 'rgba(16,185,129,0.7)', borderColor: GREEN, borderWidth: 1, borderRadius: 4
      }
    ]
  },
  options: {
    responsive: true,
    plugins: {
      legend: { display: true, position: 'bottom', labels: { usePointStyle: true, padding: 20 } },
      tooltip: {
        callbacks: {
          label: ctx => {
            const raw = ctx.raw;
            return ctx.dataset.label + ': ' + raw[0].toLocaleString() + ' ‚Äì ' + raw[1].toLocaleString() + ' $';
          }
        }
      }
    },
    scales: {
      y: { ticks: { callback: v => fmt(v) }, grid: { color: GRID } },
      x: { grid: { display: false } }
    }
  }
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CHART 3 ‚Äî Drawdowns
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
new Chart(document.getElementById('chartDrawdowns'), {
  type: 'bar',
  data: {
    labels: ['Cycle 1\n2013‚Äì2015', 'Cycle 2\n2017‚Äì2018', 'Cycle 3\n2021‚Äì2022', 'Cycle 4\nPessimiste', 'Cycle 4\nNeutre', 'Cycle 4\nOptimiste'],
    datasets: [{
      label: 'Drawdown depuis ATH (%)',
      data: [-86, -84, -77, -75, -56, -50],
      backgroundColor: [
        'rgba(148,163,184,0.5)',
        'rgba(148,163,184,0.5)',
        'rgba(148,163,184,0.5)',
        'rgba(239,68,68,0.7)',
        'rgba(245,158,11,0.7)',
        'rgba(16,185,129,0.7)'
      ],
      borderColor: [TICK, TICK, TICK, RED, YELLOW, GREEN],
      borderWidth: 1,
      borderRadius: 6
    }]
  },
  options: {
    responsive: true,
    indexAxis: 'y',
    plugins: {
      legend: { display: false },
      tooltip: {
        callbacks: { label: ctx => ctx.parsed.x + ' %' }
      }
    },
    scales: {
      x: {
        min: -100, max: 0,
        ticks: { callback: v => v + '%' },
        grid: { color: GRID }
      },
      y: { grid: { display: false } }
    }
  }
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CHART 4 ‚Äî Probabilities (doughnut)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
new Chart(document.getElementById('chartProba'), {
  type: 'doughnut',
  data: {
    labels: ['Pessimiste (17,5 %)', 'Neutre (45 %)', 'Optimiste (27,5 %)', 'Inclassable (10 %)'],
    datasets: [{
      data: [17.5, 45, 27.5, 10],
      backgroundColor: [RED, YELLOW, GREEN, 'rgba(100,116,139,0.4)'],
      borderColor: 'rgba(0,0,0,0.3)',
      borderWidth: 2
    }]
  },
  options: {
    responsive: true,
    cutout: '65%',
    plugins: {
      legend: { position: 'bottom', labels: { usePointStyle: true, padding: 16 } },
      tooltip: { callbacks: { label: ctx => ctx.label + ' ‚Äî ' + ctx.parsed + ' %' } }
    }
  }
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CHART 5 ‚Äî Horizon ranges (Compare tab)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
new Chart(document.getElementById('chartHorizon'), {
  type: 'bar',
  data: {
    labels: ['2026 (12 mois)', '2027‚Äì2028', '2029‚Äì2030'],
    datasets: [
      {
        label: 'Pessimiste',
        data: [[25000,80000],[30000,120000],[50000,200000]],
        backgroundColor: 'rgba(239,68,68,0.6)', borderColor: RED, borderWidth: 1, borderRadius: 4
      },
      {
        label: 'Neutre',
        data: [[45000,120000],[65000,250000],[100000,500000]],
        backgroundColor: 'rgba(245,158,11,0.6)', borderColor: YELLOW, borderWidth: 1, borderRadius: 4
      },
      {
        label: 'Optimiste',
        data: [[55000,250000],[100000,500000],[200000,1000000]],
        backgroundColor: 'rgba(16,185,129,0.6)', borderColor: GREEN, borderWidth: 1, borderRadius: 4
      }
    ]
  },
  options: {
    responsive: true,
    plugins: {
      legend: { display: true, position: 'bottom', labels: { usePointStyle: true, padding: 20 } },
      tooltip: {
        callbacks: {
          label: ctx => {
            const raw = ctx.raw;
            return ctx.dataset.label + ': ' + raw[0].toLocaleString() + ' ‚Äì ' + raw[1].toLocaleString() + ' $';
          }
        }
      }
    },
    scales: {
      y: { type: 'logarithmic', ticks: { callback: v => fmt(v) }, grid: { color: GRID } },
      x: { grid: { display: false } }
    }
  }
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CHART 6 ‚Äî Historical cycles (Compare tab)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
new Chart(document.getElementById('chartCycles'), {
  type: 'bar',
  data: {
    labels: ['Cycle 1 (2012‚Äì2015)', 'Cycle 2 (2016‚Äì2018)', 'Cycle 3 (2020‚Äì2022)', 'Cycle 4 ‚Äî Neutre'],
    datasets: [
      {
        label: 'Top (USD)',
        data: [1150, 19800, 69000, 200000],
        backgroundColor: 'rgba(249,115,22,0.7)',
        borderColor: ORANGE,
        borderWidth: 1,
        borderRadius: 6
      },
      {
        label: 'Bottom (USD)',
        data: [170, 3120, 15500, 55000],
        backgroundColor: 'rgba(59,130,246,0.5)',
        borderColor: BLUE,
        borderWidth: 1,
        borderRadius: 6
      }
    ]
  },
  options: {
    responsive: true,
    plugins: {
      legend: { position: 'bottom', labels: { usePointStyle: true, padding: 20 } },
      tooltip: { callbacks: { label: ctx => ctx.dataset.label + ': ' + ctx.parsed.y.toLocaleString() + ' $' } }
    },
    scales: {
      y: {
        type: 'logarithmic',
        ticks: { callback: v => fmt(v) },
        grid: { color: GRID }
      },
      x: { grid: { display: false } }
    }
  }
});
</script>
</body>
</html>
